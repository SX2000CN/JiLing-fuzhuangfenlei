# 错误处理

## 概述

错误处理是用户体验的关键环节。良好的错误处理能够帮助用户理解问题、恢复操作、避免再次出错，将负面体验转化为信任建立的机会。

## 设计原则

- **预防优先**：设计防止错误发生
- **清晰说明**：用用户能理解的语言
- **提供出路**：给出解决方案或替代方案
- **保持冷静**：不责怪用户

## 错误类型

### 按来源分类

| 类型 | 来源 | 示例 |
|------|------|------|
| 用户错误 | 输入不当 | 格式错误、必填为空 |
| 系统错误 | 服务异常 | 服务器错误、超时 |
| 网络错误 | 连接问题 | 断网、请求失败 |
| 权限错误 | 访问限制 | 未登录、无权限 |

### 按严重程度分类

| 级别 | 描述 | 处理 |
|------|------|------|
| 致命 | 无法继续 | 错误页面 |
| 严重 | 功能受阻 | 模态提示 |
| 一般 | 部分影响 | 内联提示 |
| 轻微 | 可忽略 | 静默处理 |

## 错误预防

### 输入约束

| 方法 | 示例 |
|------|------|
| 格式限制 | 只允许数字输入 |
| 长度限制 | 最大字符数 |
| 选择替代输入 | 下拉选择替代手动输入 |
| 实时验证 | 输入时即时检查 |

### 操作确认

| 场景 | 确认方式 |
|------|----------|
| 删除数据 | 二次确认对话框 |
| 批量操作 | 显示影响范围 |
| 不可逆操作 | 输入确认文字 |
| 重要提交 | 预览确认 |

### 智能默认

- 合理的默认值
- 自动保存草稿
- 记住用户偏好
- 智能纠错建议

## 错误展示

### 表单错误

```
┌─────────────────────────────────────┐
│ 邮箱地址 *                          │
│ ┌─────────────────────────────────┐ │
│ │ invalid-email                   │ │  ← 红色边框
│ └─────────────────────────────────┘ │
│ ⚠️ 请输入有效的邮箱地址              │  ← 错误提示
└─────────────────────────────────────┘
```

| 元素 | 规范 |
|------|------|
| 边框 | Error-500 |
| 图标 | 警告图标，可选 |
| 文字 | Error-600，14px |
| 位置 | 输入框下方 |

### 页面级错误

```
┌─────────────────────────────────────┐
│                                     │
│            [错误图标]               │
│                                     │
│         出错了                      │
│                                     │
│    抱歉，页面加载失败               │
│    请检查网络连接后重试             │
│                                     │
│         [ 重新加载 ]                │
│                                     │
└─────────────────────────────────────┘
```

### Toast 错误

| 元素 | 规范 |
|------|------|
| 背景 | Error-50 |
| 边框 | Error-200 |
| 图标 | Error-500 |
| 时长 | 5秒或手动关闭 |

## 错误信息编写

### 结构

```
[发生了什么] + [为什么] + [怎么解决]
```

### 示例

| ❌ 不好 | ✅ 好 |
|--------|-------|
| 错误 | 登录失败，密码错误。请重新输入密码 |
| 无效输入 | 手机号格式不正确，请输入11位手机号 |
| 操作失败 | 保存失败，网络连接中断。请检查网络后重试 |
| Error 500 | 服务器繁忙，请稍后再试 |

### 语气

- 使用友好、平和的语气
- 不责怪用户
- 不使用技术术语
- 提供具体指导

## 错误恢复

### 自动恢复

| 场景 | 策略 |
|------|------|
| 网络中断 | 自动重试 |
| 会话过期 | 静默刷新 |
| 数据冲突 | 自动合并 |

### 用户恢复

| 操作 | 提供 |
|------|------|
| 重试 | 重试按钮 |
| 返回 | 返回上一步 |
| 刷新 | 刷新页面 |
| 联系支持 | 客服入口 |

### 数据保护

- 自动保存草稿
- 错误时不清空表单
- 提供恢复选项
- 本地存储备份

## HTTP 错误处理

| 状态码 | 含义 | 用户提示 |
|--------|------|----------|
| 400 | 请求错误 | 请求格式有误，请检查输入 |
| 401 | 未授权 | 请先登录 |
| 403 | 禁止访问 | 您没有权限访问此内容 |
| 404 | 未找到 | 页面不存在或已删除 |
| 500 | 服务器错误 | 服务器繁忙，请稍后重试 |
| 503 | 服务不可用 | 系统维护中，请稍后访问 |

## 平台差异

### 网页端
- 表单内联错误
- 页面级错误页
- 控制台日志
- 错误上报

### 移动端
- Toast 提示
- 全屏错误页
- 下拉重试
- 离线提示

### 桌面端
- 系统通知
- 状态栏提示
- 日志文件
- 崩溃恢复

## 无障碍考虑

- 错误信息可被屏幕阅读器读取
- 使用 `aria-invalid` 标记
- 使用 `aria-describedby` 关联
- 不仅依赖颜色传达错误
- 焦点移至错误位置

## 最佳实践

### ✅ 推荐
- 预防胜于提示
- 提供具体解决方案
- 保留用户输入
- 记录错误日志

### ❌ 避免
- 显示技术错误码
- 责怪用户
- 无法恢复的死胡同
- 忽略错误静默失败

## 相关规范

- [反馈组件](规范_02_组件规范_反馈组件.md)
- [表单元素](规范_02_组件规范_表单元素.md)

---

[返回主目录](README.md)